---
# tasks file for ansible-role-arc-frontend
#

- name: copy nordugrid.repo file
  template: src=nordugrid.repo.j2 dest=/etc/yum.repos.d/nordugrid.repo owner=root mode=0644 

- name: update all the things
  yum: name=* state=latest

- name: install Nordugrid ARC packages
  yum: name={{ item }} state=present
  with_items: packages | default({})

- name: check if there's a nordugrid.repo.rpmnew
  stat: path=/etc/yum.repos.d/nordugrid.repo.rpmnew
  register: rpmnew_stat

- name: Replace old nordugrid.repo
  command: mv /etc/yum.repos.d/nordugrid.repo.rpmnew /etc/yum.repos.d/nordugrid.repo
  when: rpmnew_stat.stat.exists

- name: copy arc.conf file
  template: backup=yes src=arc.conf.j2 dest=/etc/arc.conf owner=root mode=0644 

- name: start and enable a-rex service
  service: name=a-rex state=started enabled=yes

- name: start and enable gridftpd service
  service: name=gridftpd state=started enabled=yes

- name: start and enable nordugrid-arc-bdii service
  service: name=nordugrid-arc-bdii state=started enabled=yes

- name: start and enable nordugrid-arc-slapd service
  service: name=nordugrid-arc-slapd state=started enabled=yes

- name: start and enable nordugrid-arc-inforeg service
  service: name=nordugrid-arc-inforeg state=started enabled=yes
